extends base
mixin largeOrderTable(ordersArray)
    table.table.table-condensed.table-hover                       
        thead
            tr
                th
                th Date
                th Product Name
                th Status
                th Order No
                th Customer
                th State
                th Quantity
                th Amount
                th Phone
                th Tags
                th Action
                

        tbody
            each order in ordersArray 
                each product in order.product
                    //- -console.log(order.product);

                    -const ordersDate = moment(order.createdAt).format('DD/MMM');
                    -const orderTotal = order.total.toLocaleString()
                    -const shtOrderState = order.state.split(" ").splice(0,1).join(" ")
                    -const shtOrderName = order.name.split(" ").splice(0,2).join(" ")
                    -const shtProductName = product.productName.split(" ").splice(0,3).join(" ")
                    -const tags = order.tags.join(",");
                    -var OrderId = order._id;

                    if (order.altPhone)
                        -var copiedInfo= `Product Name: ${product.productName}\n\nName: ${order.name}\n\nAddress: ${order.address}\n\nState: ${order.state}\n\nArea: ${order.area}\n\nQuantity: ${order.qty}\n\nAmount Receiving: ₦${orderTotal}\n\nPhone Number: ${order.phone}\n\nAlternative Number: ${order.altPhone}\n\n${product.delInfo}`;
                    else
                        -var copiedInfo= `Product Name: ${product.productName}\n\nName: ${order.name}\n\nAddress: ${order.address}\n\nState: ${order.state}\n\nArea: ${order.area}\n\nQuantity: ${order.qty}\n\nAmount Receiving: ₦${orderTotal}\n\nPhone Number: ${order.phone}\n\n${product.delInfo}`;


                    section
                        tr.table-row.order-table-row(style= 'height: 65px')
                            td
                                if (order.status === "Incomplete")
                                    i.Processed_order_icon.fas.fa-circle
                                else 
                                    if (order.status.split(/\W+/).length === 2)
                                        -const st = order.status.replace(' ', '_');
                                            i.fas.fa-circle(class=`${st}_order_icon`)
                                    else
                                        i.fas.fa-circle(class=`${order.status}_order_icon`)                                
                            td
                                a.py-2()=ordersDate
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)= shtProductName
                            td
                                a.order_status_text.py-2(href=`/myorder/${product._id}/${order._id}`)= order.status
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)= order.orderNum
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)=shtOrderName
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)=shtOrderState
                            td
                                a.py-2()=order.qty
                            td
                                a.py-2()=`₦${orderTotal}`
                            td
                                a.py-2.lg-table-phoneNum(style='color: #0073aa; letter-spacing: 1.5px;' name='orderPhonea' href=`tel:${order.phone}`)= order.phone
                            td
                                .d-flex
                                    a.p-order-tags.mr-4.py-2(style='font-size: 0.9rem; font-weight: 500;')=order.tags
                                    .tag-edit-btn(style='position: relative;')
                                        button.create-tags-pencil(style='border: 0;border-color: transparent; background-color: transparent; position: absolute; top: 0; right: 0; font-size: 13px;')
                                            i.lni.lni-pencil
                                form.allorders-tags-form(data-orderid= order._id style='font-size: 1rem; display: none;')
                                    input.form-control.input-order-tags( type='text', value=tags)
                                    .d-flex
                                        p.ml-1.my-1.p-0.suggested-tag-input( style='font-size: 0.8rem; background-color: black; color: white') Not Picking
                                        p.ml-1.my-1.p-0.suggested-tag-input( style='font-size: 0.8rem; background-color: black; color: white') Not Reachable
                                    .text-center
                                        button.btn.rira-color-btn.my-2.mr-2(type='submit') save
                                        button.btn.btn-secondary.my-2.cancel-tags-form(type='button') cancel
                            td
                                .d-flex.py-1
                                    button.clipboard-btn(style='border: 0;border-color: transparent; background-color: transparent;' data-clipboard-text=`${copiedInfo}` data-toggle="tooltip" data-placement="top" title="Copy delivery info")
                                        i.far.fa-copy
                                    if (order.paidOnline === true)
                                        .btn-group.dropleft
                                            button(style='border: 0;border-color: transparent; background-color: transparent;' data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                                                i.lni.lni-menu
                                            .dropdown-menu(style='min-width: 0px; padding: .3rem 0;')
                                                a.change-order-status.dropdown-item( type='button' data-orderid=`${order._id}` data-name=`${order.name}` data-status = 'Delivered Online') Mark as Delivered Online 
                                    else
                                        .btn-group.dropleft
                                            button(style='border: 0;border-color: transparent; background-color: transparent;' data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                                                i.lni.lni-menu
                                            .dropdown-menu(style='min-width: 0px; padding: .3rem 0;')
                                                a.schedule-modal-button.dropdown-item(type='button', href='#' data-toggle='modal', data-target=`#schedule-modal` data-orderid =`${order._id}`) Schedule Order
                                                a.change-order-status.dropdown-item( type='button' href='#' data-orderid=`${order._id}` data-name=`${order.name}` data-status = 'Processed' ) Mark as Processed 
                                                a.change-order-status.dropdown-item( type='button' href='#' data-orderid=`${order._id}` data-name=`${order.name}` data-status = 'Shipped' ) Mark as Shipped 
                                                a.change-order-status.dropdown-item( type='button' href='#' data-orderid=`${order._id}` data-name=`${order.name}` data-status = 'Canceled') Mark as Canceled 
                                                a.change-order-status.dropdown-item( type='button' href='#' data-orderid=`${order._id}` data-name=`${order.name}` data-status = 'Delivered') Mark as Delivered 
                                                a.change-order-status.dropdown-item( type='button' href='#' data-orderid=`${order._id}` data-name=`${order.name}` data-status = 'Remitted') Mark as Remitted 
block Indexcss
block content
block script

    .container(style= 'margin-top: 150px;')
        .text-right             
                select#product_link_select.form-control.ml-1.w-25(onchange="redirectSelect()")
                    each product in businessAccount.products.reverse()
                        option(value=`${product._id}` data-productslug=`${product.slug}` data-productid=`${product._id}` )=product.productName
        .row.my-5.salesTransSection(data-productid=`${product._id}`)
            #card2.col-12.col-md-6.col-xl-6
                .card.border-1.shadow-sm
                    .card-body.py-5
                        .row
                            .col-8
                                h6= `Sales for ${product.productName}`
                            .col-4
                                a.btn#button-sales.btn.btn-sm.dropdown-toggle.justify-content-end(type='button', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                                    | Today
                                #dropdownbtn.dropdown-menu.sales-today
                                    a#salesToday_btn(href='#sumOfSalesToday') Today
                                    a#salesWeekly_btn(href='#sumOfSalesWeek') This Week
                                    a#salesMonthly_btn(href='#sumOfSalesMonth') This Month
                                    a#salesLifeTime_btn(href='#sumOfSalesLifetime') Lifetime                      
                        .sumOfSalesResult.mx-auto.d-flex
                            h3#sumOfSalesResult.sales-toggle=`₦ ${salesToday}`
                            #loading-Sales-Result
                        
                                            
                                    
            #card2.col-12.col-md-6.col-xl-6
                .card.border-1.shadow-sm
                    .card-body.py-5
                        .row
                            .col-9
                                h6= `Transactions for ${product.productName}`
                            .col-3
                                .btn-group
                                a.btn#button-trans.btn.btn-sm.dropdown-toggle.justify-content-end(type='button', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                                    | Today
                                #dropdownbtn.dropdown-menu.trans-today
                                    a#transToday_btn(href='#sumOfTransToday') Today
                                    a#transWeekly_btn(href='#sumOfTransWeek') This Week
                                    a#transMonthly_btn(href='#sumOfTransMonth') This Month
                                    a#transLifeTime_btn(href='#sumOfTransLifetime') Lifetime
                        .sumOfTransResult.mx-auto.d-flex
                            h3#sumOfTransResult.trans-toggle=`₦ ${transToday}`
                            #loading-Trans-Result

    section
        .large-container.mb-5(style= 'margin-top: 150px;')
            .p-5
                h4= `All Orders for ${product.productName}:`
                .row.text-left
                    #filter-panel.collapse.filter-panel
                        .panel.panel-default
                            .panel-body
                                form.form-inline(role='form')
                                    .form-group
                                        label.mr-2( for='podStatus') POD Status:
                                        select#podStatus.form-control
                                            option(selected='', disabled='', value='') Select
                                            option(value='New_Order') New Order
                                            option(value='Processed') Processed
                                            option(value='Shipped') Shipped
                                            option(value='Schedule') Schedule
                                            option(value='Canceled') Canceled
                                            option(value='Delivered') Delivered
                                            option(value='Remitted') Remitted
                                    .form-group
                                        label.ml-2( for='paidStatus') Paid Status:
                                        select#paidStatus.form-control
                                            option(selected='', disabled='', value='') Select
                                            option(value='Paid_Online') Paid Online
                                            option(value='Shipped_Online') Shipped Online
                                            option(value='Delivered_online') Delivered Online
                                            option(value='Canceled') Canceled Online
                                    .form-group
                                        label.mx-2(style='margin-right:0;', for='pref-search') Search:
                                        input.form-control.input-sm(type='text')
                                    button.btn.btn-default.rira-color-btn.mx-2(type='submit') Search
                    button.btn.btn-primary(type='button', data-toggle='collapse', data-target='#filter-panel')
                        span.fas.fa-cog Advanced Search
                                //- form.ml-2(action=`` method="GET")
                                //-     .form-row
                                //-         .col-9
                                //-             input#inlineFormInputName.form-control(type='text', placeholder='Search order' name ='search' required='')
                                //-         .col-3
                                //-             button.btn.rira-color-btn(type='submit') Search
                                
                if (schdToday.length && currentPage === 1 && !querySearch)
                        ul.list-group
                                li.d-flex.justify-content-between
                                    h6.d-flex.justify-content-between Scheduled Today
                        +largeOrderTable(schdToday)
                if (productOrders.length)
                
                    h6.d-flex.justify-content-between Latest Orders                                                                           
                    +largeOrderTable(productOrders)
                    include _paginate
                if (!productOrders.length && querySearch)
                    .text-center
                        p.mt-2(style='font-size: 1.2rem;')= `Unable to get result for ${querySearch}. Kindly check and try again`
                if (!productOrders.length && !querySearch)
                    .text-center
                        p.mt-2(style='font-size: 1.2rem;') You don't have an order for now. Make sure you add your embed code so your customers can pay through RiraPay
                    .text-center
                        a.rira-color-btn.btn(href=`/myproduct/${product.slug}/${product._id}`) View your product
                            div(id='schedule-modal' class='modal fade' tabindex='-1', role='dialog', aria-labelledby='schedule-modalTitle', aria-hidden='true')
                                .modal-dialog.modal-dialog-centered(role='document')
                                    .modal-content
                                        .modal-header
                                            h5#exampleModalLongTitle.modal-title Schedule Order
                                            button.close(type='button', data-dismiss='modal', aria-label='Close')
                                            span(aria-hidden='true') &times;
                                        .modal-body
                                            form.schedule-order-form
                                                label.form-label(for='schedule-date-input') Pick a date                                                
                                                input#schedule-date-input.form-control(type='date', value='')
                                                .modal-footer
                                                    button.btn.btn-secondary(type='button', data-dismiss='modal') Close
                                                    button.btn.rira-color-btn(type='submit') Save changes
                            


        script.
            currentPages= #{currentPage};
            currentProduct= !{JSON.stringify(product._id)};
            $('#product_link_select').val(currentProduct)
            //- const vaoo = document.getElementById('product_link_select');
            //- const hhh = vaoo.querySelector(`option[value='${currentProduct}']`);
            //- console.log(hhh);
            $('ul.pagination a').filter(function() {
                return $(this).text() == currentPages;
            }).parent().addClass('active');
            function redirectSelect(){
                if (!e) var e = window.event;                
                var target = e.target || e.srcElement;
                const productslug = target[e.target.selectedIndex].dataset.productslug
                const productId = target[e.target.selectedIndex].dataset.productid
                window.location.assign(`/${productslug}/entries/${productId}`);
            }
            document.getElementById('schedule-date-input').valueAsDate = new Date();
            
                        