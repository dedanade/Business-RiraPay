extends base
mixin largeOrderTable(ordersArray)
    table.table.table-condensed.table-hover                       
        thead
            tr
                th Date
                th Product Name
                th Status
                th Order No
                th Customer
                th State
                th Phone
                th Amount
                th Tags
                th Action

        tbody
            each order in ordersArray 
                each product in order.product
                    //- -console.log(order.product);

                    -const ordersDate = moment(order.createdAt).format('dddd, DD/MMM/YY, h:mma');
                    -const orderTotal = order.total.toLocaleString()
                    -const shtOrderState = order.state.split(" ").splice(0,1).join(" ")
                    -const shtOrderName = order.name.split(" ").splice(0,2).join(" ")
                    -const shtProductName = product.productName.split(" ").splice(0,3).join(" ")
                    -const tags = order.tags.join(",");
                    -var OrderId = order._id;

                    if (order.altPhone)
                        -var copiedInfo= `Product Name: ${product.productName}\n\nName: ${order.name}\n\nAddress: ${order.address}\n\nState: ${order.state}\n\nArea: ${order.area}\n\nQuantity: ${order.qty}\n\nAmount Receiving: ₦${orderTotal}\n\nPhone Number: ${order.phone}\n\nAlternative Number: ${order.altPhone}\n\n${product.delInfo}`;
                    else
                        -var copiedInfo= `Product Name: ${product.productName}\n\nName: ${order.name}\n\nAddress: ${order.address}\n\nState: ${order.state}\n\nArea: ${order.area}\n\nQuantity: ${order.qty}\n\nAmount Receiving: ₦${orderTotal}\n\nPhone Number: ${order.phone}\n\n${product.delInfo}`;


                    section
                        tr.table-row.order-table-row(style= 'height: 65px')
                        
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)=ordersDate
                                                                    
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)= shtProductName
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)= order.status
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)= order.orderNum
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)=shtOrderName
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)=shtOrderState
                            td
                                a.py-2.lg-table-phoneNum(style='color: #007bff;' name='orderPhonea' href=`tel:${order.phone}`)= order.phone
                            td
                                a.py-2(href=`/myorder/${product._id}/${order._id}`)=`₦${orderTotal}`
                            td
                                .d-flex
                                    a.p-order-tags.mr-4(style='font-size: 1rem;')=order.tags
                                    .tag-edit-btn(style='position: relative;')
                                        button.create-tags-pencil(style='border: 0;border-color: transparent; background-color: transparent; position: absolute; top: 0; right: 0; font-size: 13px;')
                                            i.lni.lni-pencil
                                form.allorders-tags-form(data-orderid= order._id style='font-size: 1rem; display: none;')
                                    input.form-control.input-order-tags( type='text', value=tags)
                                    .d-flex
                                        p.ml-1.my-1.p-0.suggested-tag-input( style='font-size: 0.8rem; background-color: black; color: white') Not Picking
                                        p.ml-1.my-1.p-0.suggested-tag-input( style='font-size: 0.8rem; background-color: black; color: white') Not Reachable
                                    .text-center
                                        button.btn.rira-color-btn.my-2.mr-2(type='submit') save
                                        button.btn.btn-secondary.my-2.cancel-tags-form(type='button') cancel
                            td
                                .d-flex.py-1
                                    button.clipboard-btn(style='border: 0;border-color: transparent; background-color: transparent;' data-clipboard-text=`${copiedInfo}` data-toggle="tooltip" data-placement="top" title="Copy delivery info")
                                        i.far.fa-copy
                                    .btn-group.dropleft
                                        button(style='border: 0;border-color: transparent; background-color: transparent;' data-toggle='dropdown', aria-haspopup='true', aria-expanded='false')
                                            i.lni.lni-menu
                                        .dropdown-menu(style='min-width: 0px; padding: .3rem 0;')
                                            a.dropdown-item.schedule-modal-button(type='button', data-toggle='modal', data-target=`#schedule-modal` data-orderid =`${order._id}`) Schedule Order
                                            a.cancel-mobile-order.dropdown-item( type='button' href='#' data-orderid=`${order._id}` data-name=`${order.name}`) Mark as Canceled 
block Indexcss
block content
    
    section
        .large-container.mb-5(style= 'margin-top: 150px;')
            .row
                .col-12
                        .card-body.py-5.mx-2
                            ul.list-group.my-3
                                        li.d-flex.justify-content-between
                                            h4.d-flex.justify-content-between All Orders:
                                            form(action=`` method="GET")
                                                .form-row
                                                    .col-9
                                                        input#inlineFormInputName.form-control(type='text', placeholder='Search order' name ='search' required='')
                                                    .col-3
                                                        button.btn.rira-color-btn(type='submit') Search
                                            h6
                                                a.rira-color-btn.btn(href=`/mobileorders`) Mobile Mode
                            if (schdToday.length && currentPage === 1 && !querySearch)
                                    ul.list-group
                                            li.d-flex.justify-content-between
                                                h6.d-flex.justify-content-between Scheduled Today
                                    +largeOrderTable(schdToday)
                            if (orders.length)
                            
                                h6.d-flex.justify-content-between Latest Orders                                                                           
                                +largeOrderTable(orders)
                            
                            include _paginate
                            div(id='schedule-modal' class='modal fade' tabindex='-1', role='dialog', aria-labelledby='schedule-modalTitle', aria-hidden='true')
                                .modal-dialog.modal-dialog-centered(role='document')
                                    .modal-content
                                        .modal-header
                                            h5#exampleModalLongTitle.modal-title Schedule Order
                                            button.close(type='button', data-dismiss='modal', aria-label='Close')
                                            span(aria-hidden='true') &times;
                                        .modal-body
                                            form.schedule-order-form
                                                input(type="hidden" id="schedule-orderId" value="")
                                                label.form-label(for='schedule-date-input') Pick a date                                                
                                                input#schedule-date-input.form-control(type='date', value='')
                                                .modal-footer
                                                    button.btn.btn-secondary(type='button', data-dismiss='modal') Close
                                                    button.btn.rira-color-btn(type='submit') Save changes
                            if (!orders.length && querySearch)
                                .text-center
                                    p.mt-2(style='font-size: 1.2rem;')= `Unable to get result for ${querySearch}. Kindly check and try again`
                            if (!orders.length && !querySearch)
                                .text-center
                                    p.mt-2(style='font-size: 1.2rem;') You don't have an order for now. Create a new product and share the link to your customer to pay through RiraPay
                                .text-center
                                    a.rira-color-btn.btn(href='/createproduct') Create your first Product


        script.
            currentPages= #{currentPage};
            $('ul.pagination a').filter(function() {
                return $(this).text() == currentPages;
            }).parent().addClass('active');

            $('.schedule-modal-button').on("click", function () {
                var orderId = $(this).data('orderid');
                $(".modal-body #schedule-orderId").val( orderId );
            });
            document.getElementById('schedule-date-input').valueAsDate = new Date();
            
                        